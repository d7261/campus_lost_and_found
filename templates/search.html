{% extends "base.html" %}

{% block content %}
<!-- Page Title & Header -->
<div class="mb-4">
    <h1 class="fw-bold mb-1">Search Items</h1>
    <p class="text-muted">Find lost and found belongings across campus</p>
</div>

<div class="card border-0 shadow-sm p-4 mb-5" style="border-radius: 20px;">
    <form method="GET" action="{{ url_for('search') }}" class="search-form">
        <div class="input-group input-group-lg bg-light p-1" style="border-radius: 15px;">
            <span class="input-group-text bg-transparent border-0 text-muted ps-3">
                <i class="fas fa-search"></i>
            </span>
            <input type="text" name="q" class="form-control bg-transparent border-0 fs-5"
                placeholder="What are you looking for?" value="{{ query }}" required>
            <button class="btn btn-primary px-5 fw-bold" type="submit" style="border-radius: 12px;">
                Search
            </button>
        </div>
    </form>
</div>

{% if query %}
<div class="d-flex align-items-center justify-content-between mb-4">
    <h4 class="fw-bold mb-0">
        Results for "{{ query }}"
        <span class="ms-2 badge rounded-pill bg-light text-muted small px-3 py-2 border fw-normal"
            style="font-size: 0.9rem;">
            {{ items|length }} found
        </span>
    </h4>
</div>

{% if items %}
<div class="row g-4 mb-5">
    {% for item in items %}
    <div class="col-md-6 col-lg-4">
        <div class="card border-0 shadow-sm h-100 overflow-hidden search-item-card"
            style="border-radius: 20px; transition: transform 0.3s ease;">
            <!-- Card Image -->
            <div class="position-relative" style="height: 200px; background: #f8fafc;">
                {% if item.item_image_path %}
                <img src="{{ url_for('static', filename='uploads/' + item.item_image_path) }}" class="w-100 h-100"
                    alt="{{ item.item_title }}" style="object-fit: contain;">
                {% else %}
                <div class="d-flex flex-column align-items-center justify-content-center h-100 text-muted opacity-50">
                    <i class="fas fa-image fa-3x mb-2"></i>
                    <span class="small fw-bold">No Image</span>
                </div>
                {% endif %}

                <!-- Status Badge Overlay -->
                {% set badge = get_status_badge(item) %}
                <span class="badge position-absolute top-0 start-0 m-3 p-2 px-3 shadow-sm"
                    style="background: {{ badge.bg }}; color: {{ badge.color }}; border-radius: 10px; font-weight: 700;">
                    <i class="fas fa-{{ badge.icon }} me-1"></i>
                    {{ badge.label }}
                </span>
            </div>

            <div class="card-body p-4">
                <h5 class="fw-bold mb-2 text-truncate">{{ item.item_title }}</h5>
                <p class="text-muted small mb-3 text-truncate-2"
                    style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">
                    {{ item.item_description }}</p>

                <div class="d-flex flex-column gap-2 mb-4">
                    <div class="d-flex align-items-center gap-2 text-muted small">
                        <i class="fas fa-map-marker-alt opacity-50"></i>
                        <span>{{ item.item_location }}</span>
                    </div>
                </div>

                <div class="d-flex align-items-center gap-2 mb-4 p-2 bg-light rounded-3">
                    <div class="rounded-circle bg-white d-flex align-items-center justify-content-center text-primary fw-bold"
                        style="width: 32px; height: 32px; font-size: 0.8rem;">
                        {{ item.owner.user_username[0]|upper }}
                    </div>
                    <div class="small">
                        <span class="text-muted">By</span> <span class="fw-bold text-dark">{{ item.owner.user_username
                            }}</span>
                    </div>
                </div>

                <a href="{{ url_for('view_item', item_id=item.item_id) }}"
                    class="btn btn-outline-primary w-100 fw-bold py-2" style="border-radius: 12px; border-width: 2px;">
                    View Details
                </a>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="text-center py-5 bg-white shadow-sm rounded-4 mb-5">
    <div class="mb-4 text-muted opacity-25">
        <i class="fas fa-search" style="font-size: 5rem;"></i>
    </div>
    <h3 class="fw-bold">No items found</h3>
    <p class="text-muted">Try different keywords or browse categories below.</p>
</div>
{% endif %}
{% endif %}

{% if not query %}
<div class="mb-4 mt-2">
    <h4 class="fw-bold mb-1">Browse Categories</h4>
    <p class="text-muted">Explore items by their type</p>
</div>

<div class="row g-4">
    {% set categories = [
    {'id': 'electronics', 'icon': 'mobile-alt', 'name': 'Electronics', 'color': '#6366f1'},
    {'id': 'books', 'icon': 'book', 'name': 'Books & Notes', 'color': '#10b981'},
    {'id': 'clothing', 'icon': 'tshirt', 'name': 'Clothing', 'color': '#f59e0b'},
    {'id': 'personal', 'icon': 'wallet', 'name': 'Personal Items', 'color': '#ef4444'},
    {'id': 'accessories', 'icon': 'mug-hot', 'name': 'Accessories', 'color': '#8b5cf6'},
    {'id': 'other', 'icon': 'ellipsis-h', 'name': 'Other', 'color': '#64748b'}
    ] %}
    {% for cat in categories %}
    <div class="col-md-6 col-lg-4">
        <div class="card border-0 shadow-sm p-4 h-100 category-modern-card"
            style="border-radius: 20px; cursor: pointer;">
            <div class="d-flex align-items-center gap-4">
                <div class="category-modern-icon d-flex align-items-center justify-content-center"
                    style="width: 64px; height: 64px; border-radius: 16px; background: {{ cat.color }}15; color: {{ cat.color }};">
                    <i class="fas fa-{{ cat.icon }} fa-2x"></i>
                </div>
                <div>
                    <h5 class="fw-bold mb-1">{{ cat.name }}</h5>
                    <p class="text-muted small mb-0">Browse items in this category</p>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% endif %}

<style>
    .search-item-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08) !important;
    }

    .category-modern-card {
        transition: all 0.2s ease;
    }

    .category-modern-card:hover {
        background: #f8fafc;
        transform: translateY(-3px);
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.05);
    }

    .object-fit-contain {
        object-fit: contain;
    }
</style>
{% endblock %}